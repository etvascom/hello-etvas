# Etvas App

An Etvas App is an application (both Back and Front End) that can run inside an `iframe` fully integrated in the Etvas Customer Portal. It **must** be hosted on a `HTTPS` URL, so the Etvas Customer Portal can load it.

Each product listed in Customer Portal has the URL of the Etvas App configured as a property. When the End Customer uses the product (after the purchase process is successfully finished), the Etvas App is loaded from the specified URL.

## Security

The communication between Etvas App and Etvas Platform has to include two elements:

- A secret API KEY (non-shareable), stored exclusively in the Back-End Etvas App
- A token (shareable), stored in the Front-End Etvas App

#### The API Key

The API key is generated by Etvas Platform for each Service Partner and must not be used by the Front-End Etvas App and it should be typically stored in an environment variable for the Back-End Etvas App. We will provide you with an API KEY.

#### The token

The token is received in the query when the Customer Portal loads the application. You can easily verify the token with our dedicated REST endpoint.

It is a JWT token with the following structure:

```
{
  "purId": "-- UUID for purchase id --",
  "prodId": "-- UUID for product id --",
  "spId": "-- UUID for service partner id --",
  "scope": "purchase",
  "sub": "-- UUID for customer id --",
  "iss": "https://etvas.com/",
  "jti": "-- unique identifier for this token --",
  "iat": 1587713395,
  "exp": 1587716995
}
```

## The information flow

Each call to Etvas Platform must include in headers:

```
Accept: application/json
Content-Type: application/json
x-api-key: __API_KEY__
Authorization: __token__
```

Please note, although it is a Bearer token, the `Authorization` header does not include the `Bearer` prefix.

> TODO: document calls with etvas-sdk
